---
resource_registry:

  # These lines activate our network interface configuration files.
  # Notice that because we are using pre-provisioned servers, our
  # roles are named ComputeDeployedServer and
  # ControllerDeployedServer, rather than Compute and Controller.
  OS::TripleO::ComputeDeployedServer::Net::SoftwareConfig:
    network/config/compute.yaml
  OS::TripleO::ControllerDeployedServer::Net::SoftwareConfig:
    network/config/controller.yaml
  OS::TripleO::NodeExtraConfigPost: extraconfig.yaml

  # Disable swift (because we're using Ceph Rados Gateway).
  OS::TripleO::Services::SwiftProxy: OS::Heat::None
  OS::TripleO::Services::SwiftStorage: OS::Heat::None
  OS::TripleO::Services::SwiftRingBuilder: OS::Heat::None

parameter_defaults:

  # The CloudName is used in public API endpoints.
  CloudName: kumo.massopen.cloud
  DnsServers:
    - 10.13.96.1
    - 10.13.96.252

  # For a normal install these would be ControllerCount and
  # ComputeCount, but since we're using pre-provisioned servers the
  # roles have different names.
  ControllerDeployedServerCount: 3
  ComputeDeployedServerCount: 2

  KeystoneRegion: moc-kumo

  ##
  ## Network configuration
  ##

  # The InternalApi network is used for OpenStack REST API traffic
  # between the controllers and compute nodes, as well as for AMQ
  # traffic, database access, and most other traffic internal to the
  # overcloud.
  InternalApiNetCidr: 192.168.32.0/22
  InternalApiAllocationPools:
    - start: 192.168.32.10
      end: 192.168.32.254
  InternalApiNetworkVlanID: 3702

  # The Storage network is used for Cinder, Ceph, and Swift.
  StorageNetCidr: 192.168.16.0/22
  StorageAllocationPools:
    - start: 192.168.17.10
      end: 192.168.17.254
  StorageNetworkVlanID: 3700

  # The Tenant network is used for tenant-created networks.
  TenantNetworkVlanID: 3704
  TenantNetCidr: 192.168.28.0/22
  TenantAllocationPools:
    - start: 192.168.28.10
      end: 192.168.28.254

  ExternalNetCidr: 192.12.185.0/24
  ExternalInterfaceDefaultRoute: 192.12.185.1
  ExternalAllocationPools:
    - start: 192.12.185.20
      end: 192.12.185.100
  ExternalNetworkVlanID: 105
  PublicVirtualFixedIPs:
    - ip_address: 192.12.185.13


  FloatingNetworkVlanID: 3803

  ControlPlaneDefaultRoute: 192.168.24.1
  ControlPlaneNetworkVlanID: 3703

  # The overcloud nodes access the OpenStack metadata service at the
  # EC2MetadataIp address.
  EC2MetadataIp: 192.168.24.1

  # Setting NeutronExternalNetworkBridge to '' means that floating ips
  # can use any bridge. This maps to the `external_network_bridge`
  # Neutron configuration option.
  NeutronExternalNetworkBridge: "''"

  ServiceNetMap:
    # In the stock configuration, CephCluster and SwiftMgmt traffic goes
    # over the StorageManagement network, but I've disabled that in this
    # deployment.  The default rules means that in the absence of the
    # StorageManagement network, this traffic would instead go over the
    # ControlPlane network.  The following lines modify that default
    # so that the CephCluster and SwiftMgmt traffic goes over the
    # Storage network instead.
    CephClusterNetwork: storage
    SwiftMgmtNetwork: storage

    # Director likes to place the Keystone 'admin' endpoint on the
    # ControlPlane network, but since in our environment that network
    # won't be accessible from anywhere other than the undercloud,
    # we're moving that to the internal network.
    KeystoneAdminApiNetwork: internal_api

  # Set timezone of deployed hosts
  TimeZone: "US/Eastern"

  NovaApiPolicies:
    # Allow Nova instance owners to use the "reset-state" command.
    # Note that the key here ("allow_owners_to_reset") is not
    # significant (but it should be unique).
    allow_owners_to_reset:
      key: 'os_compute_api:os-admin-actions:reset_state'
      value: 'rule:admin_or_owner'
